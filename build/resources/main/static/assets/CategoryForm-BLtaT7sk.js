import{o as h,c as E,b as N,t as U,i as o,w as n,E as m,g as p,f as y,h as s,k as A,u as B,a as D,l as b}from"./index-Bu35Nny5.js";import{c as u}from"./category-C0wM35B6.js";import"./index-BuRDC5Sn.js";const F={style:{"max-width":"600px"}},T={__name:"CategoryForm",setup(G){const c=A(),V=B(),i=p(()=>!!c.params.id),v=p(()=>c.params.id),a=y({name:"",description:"",parentId:null,sortOrder:0}),f=y([]),g=p(()=>{const l=(e=null)=>f.value.filter(t=>t.parentId===e).map(t=>({id:t.id,name:t.name,children:l(t.id)}));return l()}),w=async()=>{try{const l=await u.adminGetAll();f.value=l||[]}catch(l){console.error("加载分类列表失败",l)}},x=async()=>{if(await w(),!!i.value)try{const e=(await u.adminGetAll()).find(t=>t.id===Number(v.value));e&&(a.value={name:e.name,description:e.description||"",parentId:e.parentId,sortOrder:e.sortOrder||0})}catch{m.error("加载失败")}},I=async()=>{var l,e;try{const t={name:a.value.name,description:a.value.description,parentId:a.value.parentId||null,sortOrder:a.value.sortOrder};i.value?await u.update(v.value,t):await u.create(t),m.success("保存成功"),V.push("/admin/categories")}catch(t){m.error(((e=(l=t.response)==null?void 0:l.data)==null?void 0:e.message)||"保存失败")}};return h(x),(l,e)=>{const t=s("el-input"),d=s("el-form-item"),k=s("el-tree-select"),C=s("el-input-number"),_=s("el-button"),O=s("el-form");return D(),E("div",F,[N("h2",null,U(i.value?"编辑分类":"新建分类"),1),o(O,{model:a.value,"label-width":"100px",style:{"margin-top":"20px"}},{default:n(()=>[o(d,{label:"分类名称"},{default:n(()=>[o(t,{modelValue:a.value.name,"onUpdate:modelValue":e[0]||(e[0]=r=>a.value.name=r),placeholder:"请输入分类名称"},null,8,["modelValue"])]),_:1}),o(d,{label:"描述"},{default:n(()=>[o(t,{modelValue:a.value.description,"onUpdate:modelValue":e[1]||(e[1]=r=>a.value.description=r),type:"textarea",rows:3,placeholder:"请输入描述"},null,8,["modelValue"])]),_:1}),o(d,{label:"父分类"},{default:n(()=>[o(k,{modelValue:a.value.parentId,"onUpdate:modelValue":e[2]||(e[2]=r=>a.value.parentId=r),data:g.value,props:{label:"name",value:"id",children:"children"},placeholder:"请选择父分类（不选则为根分类）",clearable:"","check-strictly":"","render-after-expand":!1},null,8,["modelValue","data"])]),_:1}),o(d,{label:"排序序号"},{default:n(()=>[o(C,{modelValue:a.value.sortOrder,"onUpdate:modelValue":e[3]||(e[3]=r=>a.value.sortOrder=r),min:0,max:9999},null,8,["modelValue"])]),_:1}),o(d,null,{default:n(()=>[o(_,{type:"primary",onClick:I},{default:n(()=>[...e[5]||(e[5]=[b("保存",-1)])]),_:1}),o(_,{onClick:e[4]||(e[4]=r=>l.$router.back())},{default:n(()=>[...e[6]||(e[6]=[b("取消",-1)])]),_:1})]),_:1})]),_:1},8,["model"])])}}};export{T as default};
