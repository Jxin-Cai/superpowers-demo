import{a as c}from"./index-DQ-5gSyr.js";import{_ as $,f as q,c as T,b as C,d as l,w as t,E as p,r,h as f,o as k,e as n,t as E,i as L,j,v as z}from"./index-DiXZHzxD.js";const F={class:"user-list"},G={class:"header"},H={__name:"UserList",setup(J){const g=f([]),d=f(!1),i=f(!1),y=f(),o=f({username:"",password:"",email:"",role:"USER"}),U={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],role:[{required:!0,message:"请选择角色",trigger:"change"}]};async function v(){try{const s=await c.get("/admin/users");g.value=s.data}catch{p.error("获取用户列表失败")}}function x(){i.value=!1,o.value={username:"",password:"",email:"",role:"USER"},d.value=!0}function D(s){i.value=!0,o.value={id:s.id,username:s.username,email:s.email,role:s.role},d.value=!0}async function I(){var s,e;await y.value.validate();try{i.value?(await c.put(`/admin/users/${o.value.id}`,{role:o.value.role}),p.success("更新成功")):(await c.post("/admin/users",o.value),p.success("创建成功")),d.value=!1,v()}catch(u){p.error(((e=(s=u.response)==null?void 0:s.data)==null?void 0:e.message)||"操作失败")}}async function N(s){try{await z.confirm("确定删除该用户吗？","提示",{type:"warning"}),await c.delete(`/admin/users/${s}`),p.success("删除成功"),v()}catch(e){e!=="cancel"&&p.error("删除失败")}}return q(()=>{v()}),(s,e)=>{const u=r("el-button"),m=r("el-table-column"),w=r("el-tag"),M=r("el-table"),b=r("el-input"),_=r("el-form-item"),V=r("el-option"),A=r("el-select"),B=r("el-form"),R=r("el-dialog");return k(),T("div",F,[C("div",G,[e[7]||(e[7]=C("h2",null,"用户管理",-1)),l(u,{type:"primary",onClick:x},{default:t(()=>[...e[6]||(e[6]=[n("新增用户",-1)])]),_:1})]),l(M,{data:g.value,border:""},{default:t(()=>[l(m,{prop:"id",label:"ID",width:"80"}),l(m,{prop:"username",label:"用户名"}),l(m,{prop:"email",label:"邮箱"}),l(m,{prop:"role",label:"角色",width:"100"},{default:t(({row:a})=>[l(w,{type:a.role==="ADMIN"?"danger":"primary"},{default:t(()=>[n(E(a.role==="ADMIN"?"管理员":"普通用户"),1)]),_:2},1032,["type"])]),_:1}),l(m,{prop:"status",label:"状态",width:"100"},{default:t(({row:a})=>[l(w,{type:a.status==="ACTIVE"?"success":"info"},{default:t(()=>[n(E(a.status==="ACTIVE"?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(m,{label:"操作",width:"200"},{default:t(({row:a})=>[l(u,{type:"text",onClick:S=>D(a)},{default:t(()=>[...e[8]||(e[8]=[n("编辑",-1)])]),_:1},8,["onClick"]),l(u,{type:"text",onClick:S=>N(a.id)},{default:t(()=>[...e[9]||(e[9]=[n("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),l(R,{modelValue:d.value,"onUpdate:modelValue":e[5]||(e[5]=a=>d.value=a),title:i.value?"编辑用户":"新增用户",width:"500px"},{footer:t(()=>[l(u,{onClick:e[4]||(e[4]=a=>d.value=!1)},{default:t(()=>[...e[10]||(e[10]=[n("取消",-1)])]),_:1}),l(u,{type:"primary",onClick:I},{default:t(()=>[...e[11]||(e[11]=[n("确定",-1)])]),_:1})]),default:t(()=>[l(B,{model:o.value,rules:U,ref_key:"formRef",ref:y,"label-width":"80px"},{default:t(()=>[l(_,{label:"用户名",prop:"username"},{default:t(()=>[l(b,{modelValue:o.value.username,"onUpdate:modelValue":e[0]||(e[0]=a=>o.value.username=a),disabled:i.value},null,8,["modelValue","disabled"])]),_:1}),i.value?j("",!0):(k(),L(_,{key:0,label:"密码",prop:"password"},{default:t(()=>[l(b,{modelValue:o.value.password,"onUpdate:modelValue":e[1]||(e[1]=a=>o.value.password=a),type:"password"},null,8,["modelValue"])]),_:1})),l(_,{label:"邮箱",prop:"email"},{default:t(()=>[l(b,{modelValue:o.value.email,"onUpdate:modelValue":e[2]||(e[2]=a=>o.value.email=a)},null,8,["modelValue"])]),_:1}),l(_,{label:"角色",prop:"role"},{default:t(()=>[l(A,{modelValue:o.value.role,"onUpdate:modelValue":e[3]||(e[3]=a=>o.value.role=a),style:{width:"100%"}},{default:t(()=>[l(V,{label:"普通用户",value:"USER"}),l(V,{label:"管理员",value:"ADMIN"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},P=$(H,[["__scopeId","data-v-9a30c95f"]]);export{P as default};
