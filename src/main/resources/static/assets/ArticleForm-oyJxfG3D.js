import{f as E,c as _,b as U,t as F,d as a,w as n,E as d,k as g,h as w,r,l as M,u as N,o as c,F as G,g as R,i as S,e as k}from"./index-DiXZHzxD.js";import{a as m}from"./article-DFaw3Ivz.js";import{c as $}from"./category-DmPU1bee.js";import"./index-DQ-5gSyr.js";const j={__name:"ArticleForm",setup(h){const p=M(),V=N(),i=g(()=>!!p.params.id),v=g(()=>p.params.id),y=w([]),t=w({title:"",content:"",categoryId:null,keywords:""}),b=async()=>{try{const o=await $.adminGetAll();y.value=o.data}catch{d.error("加载分类失败")}},I=async()=>{if(i.value)try{const e=(await m.adminGetById(v.value)).data;t.value={title:e.title,content:e.content,categoryId:e.categoryId,keywords:e.keywords||""}}catch{d.error("加载失败")}},x=async()=>{var o,e;if(!t.value.title||!t.value.content||!t.value.categoryId){d.warning("请填写完整信息");return}t.value.title,t.value.content,t.value.categoryId,t.value.keywords;try{i.value?await m.update(v.value,t.value):await m.create(t.value),d.success("保存成功"),V.push("/admin/articles")}catch(s){d.error(((e=(o=s.response)==null?void 0:o.data)==null?void 0:e.message)||"保存失败")}};return E(()=>{b(),I()}),(o,e)=>{const s=r("el-input"),u=r("el-form-item"),B=r("el-option"),C=r("el-select"),f=r("el-button"),A=r("el-form");return c(),_("div",null,[U("h2",null,F(i.value?"编辑文章":"新建文章"),1),a(A,{model:t.value,"label-width":"80px",style:{"margin-top":"20px","max-width":"800px"}},{default:n(()=>[a(u,{label:"标题"},{default:n(()=>[a(s,{modelValue:t.value.title,"onUpdate:modelValue":e[0]||(e[0]=l=>t.value.title=l),placeholder:"请输入文章标题"},null,8,["modelValue"])]),_:1}),a(u,{label:"分类"},{default:n(()=>[a(C,{modelValue:t.value.categoryId,"onUpdate:modelValue":e[1]||(e[1]=l=>t.value.categoryId=l),placeholder:"请选择分类",style:{width:"100%"}},{default:n(()=>[(c(!0),_(G,null,R(y.value,l=>(c(),S(B,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(u,{label:"内容"},{default:n(()=>[a(s,{modelValue:t.value.content,"onUpdate:modelValue":e[2]||(e[2]=l=>t.value.content=l),type:"textarea",rows:20,placeholder:"请输入 Markdown 内容"},null,8,["modelValue"])]),_:1}),a(u,{label:"关键词"},{default:n(()=>[a(s,{modelValue:t.value.keywords,"onUpdate:modelValue":e[3]||(e[3]=l=>t.value.keywords=l),placeholder:"请输入关键词，用逗号分隔（如：Java,Spring,编程）"},null,8,["modelValue"])]),_:1}),a(u,null,{default:n(()=>[a(f,{type:"primary",onClick:x},{default:n(()=>[...e[5]||(e[5]=[k("保存",-1)])]),_:1}),a(f,{onClick:e[4]||(e[4]=l=>o.$router.back())},{default:n(()=>[...e[6]||(e[6]=[k("取消",-1)])]),_:1})]),_:1})]),_:1},8,["model"])])}}};export{j as default};
