import{o as E,c as y,a as F,t as M,b as l,w as n,E as s,j as g,e as w,d as r,k as N,u as U,f as c,F as h,r as G,h as R,g as V}from"./index-Cxbc8fsp.js";import{a as m}from"./article-DdPejyfS.js";import{c as $}from"./category-DtqOXle2.js";import"./index-ByEsPxBk.js";const q={__name:"ArticleForm",setup(j){const p=N(),b=U(),i=g(()=>!!p.params.id),v=g(()=>p.params.id),f=w([]),t=w({title:"",content:"",categoryId:null}),k=async()=>{try{const o=await $.adminGetAll();f.value=o.data}catch{s.error("加载分类失败")}},x=async()=>{if(i.value)try{const e=(await m.adminGetById(v.value)).data;t.value={title:e.title,content:e.content,categoryId:e.categoryId}}catch{s.error("加载失败")}},I=async()=>{var o,e;if(!t.value.title||!t.value.content||!t.value.categoryId){s.warning("请填写完整信息");return}try{i.value?await m.update(v.value,t.value):await m.create(t.value),s.success("保存成功"),b.push("/admin/articles")}catch(u){s.error(((e=(o=u.response)==null?void 0:o.data)==null?void 0:e.message)||"保存失败")}};return E(()=>{k(),x()}),(o,e)=>{const u=r("el-input"),d=r("el-form-item"),B=r("el-option"),C=r("el-select"),_=r("el-button"),A=r("el-form");return c(),y("div",null,[F("h2",null,M(i.value?"编辑文章":"新建文章"),1),l(A,{model:t.value,"label-width":"80px",style:{"margin-top":"20px","max-width":"800px"}},{default:n(()=>[l(d,{label:"标题"},{default:n(()=>[l(u,{modelValue:t.value.title,"onUpdate:modelValue":e[0]||(e[0]=a=>t.value.title=a),placeholder:"请输入文章标题"},null,8,["modelValue"])]),_:1}),l(d,{label:"分类"},{default:n(()=>[l(C,{modelValue:t.value.categoryId,"onUpdate:modelValue":e[1]||(e[1]=a=>t.value.categoryId=a),placeholder:"请选择分类",style:{width:"100%"}},{default:n(()=>[(c(!0),y(h,null,G(f.value,a=>(c(),R(B,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"内容"},{default:n(()=>[l(u,{modelValue:t.value.content,"onUpdate:modelValue":e[2]||(e[2]=a=>t.value.content=a),type:"textarea",rows:20,placeholder:"请输入 Markdown 内容"},null,8,["modelValue"])]),_:1}),l(d,null,{default:n(()=>[l(_,{type:"primary",onClick:I},{default:n(()=>[...e[4]||(e[4]=[V("保存",-1)])]),_:1}),l(_,{onClick:e[3]||(e[3]=a=>o.$router.back())},{default:n(()=>[...e[5]||(e[5]=[V("取消",-1)])]),_:1})]),_:1})]),_:1},8,["model"])])}}};export{q as default};
